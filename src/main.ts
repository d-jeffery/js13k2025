
/*
    Little JS TypeScript Demo
    - A simple starter project
    - Shows how to use LittleJS with modules
*/

'use strict';

import {
    engineInit,
    glSetAntialias, Music, setCameraPos,
    setCanvasFixedSize, setGamepadsEnable,
    setGravity, setTouchGamepadAnalog,
    setTouchGamepadEnable, setTouchGamepadSize,
    vec2
} from 'littlejsengine';
import {IntroScene, Scene} from "./scene.ts";

const HEIGHT = 1280;
const WIDTH = 720;

let currentScene: Scene;

///////////////////////////////////////////////////////////////////////////////
function gameInit() {
    currentScene = new IntroScene()


    const song = [[[.4,0,1e4,,,,,,,,,,.01,6.8,-.2],[3,0,,1],[1.4,0,84,,,,,.7,,,,.5,,6.7,1,.01],[1.2,0,490,,.25,.45,,,,,,,.2,,,,,,,.1],[.7,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.5],[.6,0,77,,,.7,2,.41,,,,,,,,.06],[,0],[1.5,0,740,,,.15,2,.2,-.1,-.15,9,.02,,.1,.12,,.06]],[[[,-1,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[1,1,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,],[2,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,-1,,,,,,,,,,,,,,,,,,,,],[,1,2,,,,,6,6,,,,,,,,,,,,,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[1,1,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,9,,11,,4,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,],[2,-1,11,,,,,,,,-1,,,,,,,-1,11,,,,,,,,11,,,11,11,,11,,11,,,,,,,,11,,,,,,,,11,,,,,,,,11,,,11,11,,11,,],[,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-1,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[1,1,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,],[2,-1,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,],[,1,-1,,,,,,2,,,,,,,,,,6,,,,,,6,,,,,,,,,,,,,,,,,,,,,,,,-1,,,,,,6,,,,7,,,,,,,,],[3,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,4,,,,12,,,,],[3,,6,,,,,,6,,,,,,,,,,6,,,,,,6,,,,9,,,,7,,6,,,,,,6,,6,,,,6,,,,6,,,,,,6,,,,,,,,,,]],[[4,-.6,-1,,9,,9,9,,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,20,9,,9,,9,,9,,9,,9,,9,,9,,9,9],[1,1,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,],[2,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,],[,1,,,,,9,,,,,,,,9,,-1,,,,,,9,,6,,,,,,9,,,,,,,,9,,,,,,,,9,,-1,,,,,,9,,,,7,,,,,,,,],[3,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,4,,,,12,,,,],[3,,6,,,,,,6,,,,,,,,,,6,,,,,,6,,,,9,,,,7,,6,,,,,,6,,6,,,,6,,,,6,,,,,,6,,,,,,,,,,],[,,,,,,,,,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[4,-.6,-1,,9,,9,9,,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,20,9,,9,,9,,9,,9,,9,,9,,9,,9,9],[1,1,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,],[2,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,-1,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,],[,1,,,,,9,,,,,,,,9,,,,,,,,9,,6,,,,,,9,,,,,,,,9,,,,,,,,9,,-1,,,,,,9,,,,7,,,,,,,,],[3,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,4,,,,12,,,,],[3,,6,,,,,,6,,,,,,,,,,6,,,,,,6,,,,9,,,,7,,6,,,,,,6,,6,,,,6,,,,6,,,,,,6,,,,,,,,,,],[,,,,,,,,,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,,10,,,,,,10,,,,,,,,,,,,10,,,,10,,,,10,,3,,,,10,,,,,,10,,,,,,,,,,,,,,,,10,,,,10,,3,,,,]],[[4,-.6,9,,9,,9,9,,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,20,9,,9,,9,,9,,9,,9,,9,,9,,9,9],[1,1,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,],[2,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,-1,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,],[,1,,,,,9,,,,,,,,9,,,,,,,,9,,6,,,,,,9,,,,,,,,9,,,,,,,,9,,-1,,,,,,9,,,,7,,,,,,,,],[3,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,4,,,,12,,,,],[3,,6,,,,,,6,,,,,,,,,,6,,,,,,6,,,,9,,,,7,,6,,,,,,6,,6,,,,6,,,,6,,,,,,6,,,,,,,,,,],[,,,,,,,,,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,,10,,,,,,10,,,,,,,,,,,,10,,,,10,,,,10,,3,,,,10,,,,,,10,,,,,,,,,,,,,,,,10,,,,10,,3,,,,],[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[4,-.6,-1,,9,,9,9,,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,-1,9,,9,,9,,9,20,9,,9,,9,,9,,9,,9,,9,,9,,9,9],[1,1,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,],[2,,9,,,,,,,,,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,-1,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,],[,1,,,,,9,,,,,,,,9,,,,,,,,9,,6,,,,,,9,,,,,,,,9,,,,,,,,9,,-1,,,,,,9,,,,7,,,,,,,,],[3,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,4,,,,12,,,,],[3,,6,,,,,,6,,,,,,,,,,6,,,,,,6,,,,9,,,,7,,6,,,,,,6,,6,,,,6,,,,6,,,,,,6,,,,,,,,,,],[,,,,,,,,,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,,10,,,,,,10,,,,,,,,,,,,10,,,,10,,,,10,,3,,,,10,,,,,,10,,,,,,,,,,,,,,,,10,,,,10,,3,,,,],[6,,,,26,,28,,,,26,28,,28,,,,,,,26,,28,,,,26,28,,28,,,26,,,,26,,28,,,,26,28,,28,,,,,,,26,,28,,,,26,28,,,31,,33,,]],[[4,-.6,-1,,9,,9,9,,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,20,9,,9,,9,,9,,9,,9,,9,,9,,9,9],[1,1,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,],[2,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,-1,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,],[,1,,,,,9,,,,,,,,9,,,,,,,,9,,6,,,,,,9,,,,,,,,9,,,,,,,,9,,-1,,,,,,9,,,,7,,,,,,,,],[3,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,4,,,,12,,,,],[3,,6,,,,,,6,,,,,,,,,,6,,,,,,6,,,,9,,,,7,,6,,,,,,6,,6,,,,6,,,,6,,,,,,6,,,,,,,,,,],[,,,,,,,,,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,,10,,,,,,10,,,,,,,,,,,,10,,,,10,,,,10,,3,,,,10,,,,,,10,,,,,,,,,,,,,,,,10,,,,10,,3,,,,],[6,,,,26,,28,,,,26,28,,28,,,,,,,26,,28,,,,26,28,,31,,,28,,,,26,,28,,,,26,28,,28,,,,,,,26,,28,,,,26,28,,31,,,33,,]],[[4,-.6,9,,9,,9,9,,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,20,9,,9,,9,,9,,9,,9,,9,,9,,9,9],[1,1,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,],[2,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,-1,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,],[,1,,,,,9,,,,,,,,9,,,,,,,,9,,6,,,,,,9,,,,,,,,9,,,,,,,,9,,-1,,,,,,9,,,,7,,,,,,,,],[3,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,4,,,,12,,,,],[3,,6,,,,,,6,,,,,,,,,,6,,,,,,6,,,,9,,,,7,,6,,,,,,6,,6,,,,6,,,,6,,,,,,6,,,,,,,,,,],[,,,,,,,,,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,,10,,,,,,10,,,,,,,,,,,,10,,,,10,,,,10,,3,,,,10,,,,,,10,,,,,,,,,,,,,,,,10,,,,10,,3,,,,],[6,,,,26,,28,,,,26,28,,28,,,,,,,26,,28,,,,26,28,,31,,,28,,,,26,,28,,,,26,28,,28,,,,,,,26,,28,,,,26,28,,31,,,33,,],[7,,,,7,,9,,11,,,,14,,,,9,,14,,,,16,,,,14,,11,,9,,7,,,,7,,9,,11,,,,14,,,,11,,,,9,,,,7,,,,9,,,,,,]]],[4,5,6,8,8,8],108,{"title":"Cataclysm","instruments":["snare","ghost","Kick","Instrument 3","hats","bass","lead","lead2"],"patterns":["Pattern 0","Pattern 1","Pattern 2","Pattern 3","Pattern 4","Pattern 5","Pattern 6","Pattern 7","Pattern 8"]}]
    // @ts-ignore
    const music = new Music(song)
    music.play(vec2(), 0.3, 1, 0, true)


/*
    /*const code =
        "void mainImage(out vec4 fragColor, in vec2 fragCoord)" +
        "{" +
            "vec2 uv = fragCoord.xy / iResolution.xy;" +
            "vec4 waterColor = vec4(1.0);" +
            "float reflactionY = 0.16;" +
            "if (uv.y <= reflactionY) {" +
                "float oy = uv.y;" +
                "uv.y = 2.0*reflactionY - uv.y;" +
                "uv.x = uv.x - ((uv.x-0.5)*0.2) * (1.0-oy/reflactionY);" +
                "uv.y = uv.y + sin(1.0/(oy-reflactionY) + iTime *10.0)*0.003;" +
                "waterColor = vec4(0.7, 0.85, 1.0, 1.0);" +
            "}" +
            //"uv.y = 1.0 - uv.y;" +
            "fragColor = texture(iChannel0, uv) * waterColor;" +
        "}"

    initPostProcess(code, false)*/
}

///////////////////////////////////////////////////////////////////////////////
function gameUpdate() {
    currentScene.update()

    if (!currentScene.isFinished()) {
        return;
    }

    currentScene.clean()
    setCameraPos(vec2(0, 0));
    // setCameraScale(35)

    currentScene = currentScene.getNextScene()
}

///////////////////////////////////////////////////////////////////////////////
function gameUpdatePost() {

}

///////////////////////////////////////////////////////////////////////////////
function gameRender() {
    currentScene.draw()
}

///////////////////////////////////////////////////////////////////////////////
function gameRenderPost() {
    currentScene.drawOverlay()
}

setCanvasFixedSize(vec2(WIDTH, HEIGHT))
setGravity(-0.01)
setTouchGamepadEnable(true)
setTouchGamepadAnalog(true)
setTouchGamepadSize(175)
setGamepadsEnable(true)
glSetAntialias( false)
// engineAddPlugin()

// setGlEnable(true)


// Startup LittleJS Engine
engineInit(
    gameInit,
    gameUpdate,
    gameUpdatePost,
    gameRender,
    gameRenderPost,
    ['black_cat.png']);