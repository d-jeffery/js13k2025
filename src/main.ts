
/*
    Little JS TypeScript Demo
    - A simple starter project
    - Shows how to use LittleJS with modules
*/

'use strict';

import {
    engineInit,
    glSetAntialias, Music, setCameraPos,
    setCanvasFixedSize, setGamepadsEnable,
    setGravity, setTouchGamepadAnalog,
    setTouchGamepadEnable, setTouchGamepadSize,
    vec2
} from 'littlejsengine';
import {IntroScene, Scene} from "./scene.ts";

const HEIGHT = 1280;
const WIDTH = 720;

let currentScene: Scene;

///////////////////////////////////////////////////////////////////////////////
function gameInit() {
    currentScene = new IntroScene()


    const song = [[[.4,0,1e4,,,,,,,,,,.01,6.8,-.2],[3,0,,1],[1.4,0,84,,,,,.7,,,,.5,,6.7,1,.01],[1.2,0,490,,.25,.45,,,,,,,.2,,,,,,,.1],[.7,0,4e3,,,.03,2,1.25,,,,,.02,6.8,-.3,,.5],[.6,0,77,,,.7,2,.41,,,,,,,,.06],[,0],[1.5,0,740,,,.15,2,.2,-.1,-.15,9,.02,,.1,.12,,.06]],[[[,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[1,1,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,],[2,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,-1,,,,,,,,,,,,,,,,,,,,],[,1,2,,,,,6,6,,,,,,,,,,,,,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[1,1,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,9,,11,,4,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,],[2,-1,11,,,,,,,,-1,,,,,,,-1,11,,,,,,,,11,,,11,11,,11,,11,,,,,,,,11,,,,,,,,11,,,,,,,,11,,,11,11,,11,,],[,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[1,1,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,],[2,-1,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,],[,1,-1,,,,,,2,,,,,,,,,,6,,,,,,6,,,,,,,,,,,,,,,,,,,,,,,,-1,,,,,,6,,,,7,,,,,,,,],[3,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,4,,,,12,,,,],[3,,6,,,,,,6,,,,,,,,,,6,,,,,,6,,,,9,,,,7,,6,,,,,,6,,6,,,,6,,,,6,,,,,,6,,,,,,,,,,]],[[4,-.6,9,,9,,9,9,,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,20,9,,9,,9,,9,,9,,9,,9,,9,,9,9],[1,1,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,],[2,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,],[,1,,,,,9,,,,,,,,9,,-1,,,,,,9,,6,,,,,,9,,,,,,,,9,,,,,,,,9,,-1,,,,,,9,,,,7,,,,,,,,],[3,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,4,,,,12,,,,],[3,,6,,,,,,6,,,,,,,,,,6,,,,,,6,,,,9,,,,7,,6,,,,,,6,,6,,,,6,,,,6,,,,,,6,,,,,,,,,,],[,,,,,,,,,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[4,-.6,9,,9,,9,9,,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,20,9,,9,,9,,9,,9,,9,,9,,9,,9,9],[1,1,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,],[2,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,-1,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,],[,1,,,,,9,,,,,,,,9,,,,,,,,9,,6,,,,,,9,,,,,,,,9,,,,,,,,9,,-1,,,,,,9,,,,7,,,,,,,,],[3,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,4,,,,12,,,,],[3,,6,,,,,,6,,,,,,,,,,6,,,,,,6,,,,9,,,,7,,6,,,,,,6,,6,,,,6,,,,6,,,,,,6,,,,,,,,,,],[,,,,,,,,,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,,10,,,,,,10,,,,,,,,,,,,10,,,,10,,,,10,,3,,,,10,,,,,,10,,,,,,,,,,,,,,,,10,,,,10,,3,,,,]],[[4,-.6,9,,9,,9,9,,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,20,9,,9,,9,,9,,9,,9,,9,,9,,9,9],[1,1,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,],[2,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,-1,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,],[,1,,,,,9,,,,,,,,9,,,,,,,,9,,6,,,,,,9,,,,,,,,9,,,,,,,,9,,-1,,,,,,9,,,,7,,,,,,,,],[3,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,4,,,,12,,,,],[3,,6,,,,,,6,,,,,,,,,,6,,,,,,6,,,,9,,,,7,,6,,,,,,6,,6,,,,6,,,,6,,,,,,6,,,,,,,,,,],[,,,,,,,,,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,,10,,,,,,10,,,,,,,,,,,,10,,,,10,,,,10,,3,,,,10,,,,,,10,,,,,,,,,,,,,,,,10,,,,10,,3,,,,],[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[4,-.6,9,,9,,9,9,,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,20,9,,9,,9,,9,,9,,9,,9,,9,,9,9],[1,1,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,],[2,,9,,,,,,,,,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,-1,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,],[,1,,,,,9,,,,,,,,9,,,,,,,,9,,6,,,,,,9,,,,,,,,9,,,,,,,,9,,-1,,,,,,9,,,,7,,,,,,,,],[3,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,4,,,,12,,,,],[3,,6,,,,,,6,,,,,,,,,,6,,,,,,6,,,,9,,,,7,,6,,,,,,6,,6,,,,6,,,,6,,,,,,6,,,,,,,,,,],[,,,,,,,,,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,,10,,,,,,10,,,,,,,,,,,,10,,,,10,,,,10,,3,,,,10,,,,,,10,,,,,,,,,,,,,,,,10,,,,10,,3,,,,],[6,,,,26,,28,,,,26,28,,28,,,,,,,26,,28,,,,26,28,,28,,,26,,,,26,,28,,,,26,28,,28,,,,,,,26,,28,,,,26,28,,,31,,33,,]],[[4,-.6,9,,9,,9,9,,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,20,9,,9,,9,,9,,9,,9,,9,,9,,9,9],[1,1,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,],[2,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,-1,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,],[,1,,,,,9,,,,,,,,9,,,,,,,,9,,6,,,,,,9,,,,,,,,9,,,,,,,,9,,-1,,,,,,9,,,,7,,,,,,,,],[3,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,4,,,,12,,,,],[3,,6,,,,,,6,,,,,,,,,,6,,,,,,6,,,,9,,,,7,,6,,,,,,6,,6,,,,6,,,,6,,,,,,6,,,,,,,,,,],[,,,,,,,,,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,,10,,,,,,10,,,,,,,,,,,,10,,,,10,,,,10,,3,,,,10,,,,,,10,,,,,,,,,,,,,,,,10,,,,10,,3,,,,],[6,,,,26,,28,,,,26,28,,28,,,,,,,26,,28,,,,26,28,,31,,,28,,,,26,,28,,,,26,28,,28,,,,,,,26,,28,,,,26,28,,31,,,33,,]],[[4,-.6,9,,9,,9,9,,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,,9,20,9,,9,,9,,9,,9,,9,,9,,9,,9,9],[1,1,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,4,,9,,11,,14,,],[2,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,9,,,,,-1,,,9,,,,,,,,9,,,,,,,,9,,,,,,,,],[,1,,,,,9,,,,,,,,9,,,,,,,,9,,6,,,,,,9,,,,,,,,9,,,,,,,,9,,-1,,,,,,9,,,,7,,,,,,,,],[3,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,,,,,,,,,2,,,,,,2,,4,,,,12,,,,],[3,,6,,,,,,6,,,,,,,,,,6,,,,,,6,,,,9,,,,7,,6,,,,,,6,,6,,,,6,,,,6,,,,,,6,,,,,,,,,,],[,,,,,,,,,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,,10,,,,,,10,,,,,,,,,,,,10,,,,10,,,,10,,3,,,,10,,,,,,10,,,,,,,,,,,,,,,,10,,,,10,,3,,,,],[6,,,,26,,28,,,,26,28,,28,,,,,,,26,,28,,,,26,28,,31,,,28,,,,26,,28,,,,26,28,,28,,,,,,,26,,28,,,,26,28,,31,,,33,,],[7,,,,7,,9,,11,,,,14,,,,9,,14,,,,16,,,,14,,11,,9,,7,,,,7,,9,,11,,,,14,,,,11,,,,9,,,,7,,,,9,,,,,,]]],[0,2,3,4,5,6,7,8,8,8,8,2,0],108,{"title":"Cataclysm","instruments":["snare","ghost","Kick","Instrument 3","hats","bass","lead","lead2"],"patterns":["Pattern 0","Pattern 1","Pattern 2","Pattern 3","Pattern 4","Pattern 5","Pattern 6","Pattern 7","Pattern 8"]}]
    // @ts-ignore
    const music = new Music(song)
    music.play()

/*    const song = [[[1.8,0,72,,,.2,,4,-2,6,50,.15,,6],[,0,655,,,.09,3,1.65,,,,,.02,3.8,-.1,,.2],[1.2,0,23,,,.2,3,4,,,3,.9,.05],[1.5,0,740,,,.15,2,.2,-.1,-.15,9,.02,,.1,.12,,.06]],[[[3,-1,13,13,13,8,13,,,,,,,,,,,,11,11,11,6,11,,,,,,,,,,,,10,10,10,6,10,,,,,,,,,6,8,10,8,8,8,5,13,,8,8,8,5,13,,,,,,],[,1,25,,25,,,,,,,,,,,,,25,25,,25,,,,,,,25,,,25,,25,25,25,,25,,,,,,,,,,,25,25,25,25,,25,,,,,,,,,,,,,,],[2,-1,13,,25,,13,13,25,13,,13,25,13,13,13,25,,13,,25,,13,13,25,13,,13,25,13,13,13,,,13,,25,,13,13,25,13,,13,25,13,13,13,25,,13,,25,,13,13,25,13,,13,25,13,13,13,25,,]],[[3,-1,13,13,13,8,13,,,,,,,,,,,,11,11,11,6,11,,,,,,,,,,,,10,10,10,6,10,,,,,,,,,6,8,10,8,8,8,5,13,,8,8,8,5,13,8,8,8,5,13],[2,-1,13,,25,,13,13,25,13,,13,25,13,13,13,25,27,11,,23,,11,11,23,11,,11,23,11,11,11,23,22,18,,30,,18,18,30,18,,18,30,18,18,18,30,22,13,,25,,13,13,25,13,,13,25,13,13,13,25,,],[,1,25,,25,,,,,,,,,,,,,25,25,,25,,,,,,,,,,,,,,25,,25,,,,,,,,,,,25,25,25,25,,25,,,,,,,,,,,,,,],[1,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,13,13,13,13,13,13,13,13]],[[3,-1,13,13,13,8,13,,13,15,17,17,15,13,20,20,18,17,18,,,,17,,15,,,,17,,18,,22,22,22,,18,,,,25,25,25,,22,,,18,20,22,20,,,,,,,,,,,,,,,,],[2,-1,13,,25,,13,13,25,13,,13,25,13,13,13,25,27,11,,23,,11,11,23,11,,11,23,11,11,11,23,22,18,,30,,18,18,30,18,,18,30,18,18,18,30,22,13,,25,,13,13,25,13,,13,25,13,13,13,25,,],[,1,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,],[1,1,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,13,,13]],[[3,-1,13,,25,,13,13,25,13,,13,25,13,13,13,25,,11,,23,,11,11,23,11,,11,23,11,11,11,23,,10,,22,,10,10,22,10,,10,22,10,10,6,8,10,20,25,20,20,25,20,,20,25,20,20,20,25,,20,,],[2,-1,13,,25,,13,13,25,13,,13,25,13,13,13,25,,13,,25,,13,13,25,13,,13,25,13,13,13,25,,13,,25,,13,13,25,13,,13,25,13,13,13,25,,13,,25,,13,13,25,13,,13,25,13,13,13,25,,],[,1,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,],[1,1,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,13,,13]],[[3,-1,13,,,,,,8,,17,15,13,,17,15,13,,15,,,,10,13,15,10,13,15,10,13,15,10,13,15,12,,,,,,8,15,,,,,17,15,13,8,13,,,,,,10,8,,20,20,20,20,20,20,20],[2,-1,13,,25,,13,13,25,13,,13,25,13,13,13,25,,15,,27,,15,15,27,15,,15,27,15,15,15,27,32,20,,32,,20,20,32,20,,20,32,20,20,20,32,,13,,25,,13,13,25,20,,20,32,20,20,20,32,,],[,1,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,],[1,1,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,13,,13]],[[3,-1,13,,,,,,8,,17,,,,18,17,15,,18,,,,13,,,,10,,,,6,,,,8,12,15,12,20,,8,12,15,12,20,,22,20,15,,13,,,,,,10,,8,,,,,8,20,8],[2,-1,13,,25,25,13,,25,25,13,,25,25,13,,25,25,15,,27,27,15,,27,27,15,,27,27,15,,27,27,20,,32,32,20,,32,32,20,,32,32,20,,32,32,13,,25,25,13,,25,25,20,,32,32,20,,32,34],[,1,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,],[1,1,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,13,,13]],[[3,-1,13,,,,,,8,,17,,,,18,17,15,,18,,,,13,,,,10,,,,6,,,,8,12,15,12,20,,8,12,15,12,20,,22,20,15,,13,,,,,,10,,8,,,,,8,20,8],[,1,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,],[1,1,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,13,,13]],[[,1,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,,,25,25,,25,25,,,,,,25,,,,25,,,25,,,,25,25,25,25,25],[1,1,,,,,13,,,,,,,,13,,,,,,,,13,,,,,,,,13,,13,,,,,,13,,,,,,,,13,,,,,,,,13,13,,13,,13,13,13,13,13,13,13]]],[0,1,2,2,3,3,2,2,4,4,5,6,6,7,2,2,3],,{"title":"I am back","notes":"MOD pattern data for the song 'I am back', by Sky","instruments":["Instrument 0","Instrument 1","Instrument 2","Instrument 3"],"patterns":["Pattern 0","Pattern 1","Pattern 2","Pattern 3","Pattern 4","Pattern 5","Pattern 6","Pattern 7"]}]

    // @ts-ignore
    const music = new Music(song)
    music.play()*/

    /*const code =
        "void mainImage(out vec4 fragColor, in vec2 fragCoord)" +
        "{" +
            "vec2 uv = fragCoord.xy / iResolution.xy;" +
            "vec4 waterColor = vec4(1.0);" +
            "float reflactionY = 0.16;" +
            "if (uv.y <= reflactionY) {" +
                "float oy = uv.y;" +
                "uv.y = 2.0*reflactionY - uv.y;" +
                "uv.x = uv.x - ((uv.x-0.5)*0.2) * (1.0-oy/reflactionY);" +
                "uv.y = uv.y + sin(1.0/(oy-reflactionY) + iTime *10.0)*0.003;" +
                "waterColor = vec4(0.7, 0.85, 1.0, 1.0);" +
            "}" +
            //"uv.y = 1.0 - uv.y;" +
            "fragColor = texture(iChannel0, uv) * waterColor;" +
        "}"

    initPostProcess(code, false)*/
}

///////////////////////////////////////////////////////////////////////////////
function gameUpdate() {
    currentScene.update()

    if (!currentScene.isFinished()) {
        return;
    }

    currentScene.clean()
    setCameraPos(vec2(0, 0));
    // setCameraScale(35)

    currentScene = currentScene.getNextScene()
}

///////////////////////////////////////////////////////////////////////////////
function gameUpdatePost() {

}

///////////////////////////////////////////////////////////////////////////////
function gameRender() {
    currentScene.draw()
}

///////////////////////////////////////////////////////////////////////////////
function gameRenderPost() {
    currentScene.drawOverlay()
}

setCanvasFixedSize(vec2(WIDTH, HEIGHT))
setGravity(-0.01)
setTouchGamepadEnable(true)
setTouchGamepadAnalog(true)
setTouchGamepadSize(175)
setGamepadsEnable(true)
glSetAntialias( false)
// engineAddPlugin()

// setGlEnable(true)


// Startup LittleJS Engine
engineInit(
    gameInit,
    gameUpdate,
    gameUpdatePost,
    gameRender,
    gameRenderPost,
    ['black_cat.png']);